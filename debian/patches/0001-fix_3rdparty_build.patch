From: Debian Scientific Computing Team <pkg-scicomp-devel@lists.alioth.debian.org>
Date: Mon, 6 Jun 2011 14:26:35 +0100
Subject: [PATCH] fix_3rdparty_build

# Copyright Nobuhiro Iwamatsu <iwamatsu@debian.org>
# This patch disable building 3rdparty library and set using debian package.
---
 3rdparty/CMakeLists.txt        |    4 ++--
 OpenCVConfig.cmake.in          |    2 +-
 OpenCVFindOpenEXR.cmake        |    2 +-
 modules/core/CMakeLists.txt    |    2 +-
 modules/highgui/CMakeLists.txt |    6 +++---
 5 files changed, 8 insertions(+), 8 deletions(-)

diff --git a/3rdparty/CMakeLists.txt b/3rdparty/CMakeLists.txt
index ba69648..6b59471 100644
--- a/3rdparty/CMakeLists.txt
+++ b/3rdparty/CMakeLists.txt
@@ -2,8 +2,8 @@ if(ANDROID)
  configure_file("${CMAKE_SOURCE_DIR}/Android.mk.modules.in" "${CMAKE_CURRENT_BINARY_DIR}/Android.mk")
 endif()
 
-add_subdirectory(lapack)
-add_subdirectory(zlib)
+# add_subdirectory(lapack)
+# add_subdirectory(zlib)
 if(WITH_JASPER AND NOT JASPER_FOUND)
 	add_subdirectory(libjasper)
 endif()
diff --git a/OpenCVConfig.cmake.in b/OpenCVConfig.cmake.in
index 8efd602..11845b5 100644
--- a/OpenCVConfig.cmake.in
+++ b/OpenCVConfig.cmake.in
@@ -91,7 +91,7 @@ IF (NOT @OPENCV_BUILD_SHARED_LIB@)
 
 	set(OpenCV_LIBS @OPENCV_LINKER_LIBS@ @IPP_LIBS@ @HIGHGUI_LIBRARIES@ ${OpenCV_LIBS})
 
-    set(OPENCV_EXTRA_COMPONENTS @JPEG_LIBRARIES@ @PNG_LIBRARIES@ @TIFF_LIBRARIES@ @JASPER_LIBRARIES@ zlib opencv_lapack)
+    set(OPENCV_EXTRA_COMPONENTS @JPEG_LIBRARIES@ @PNG_LIBRARIES@ @TIFF_LIBRARIES@ @JASPER_LIBRARIES@ lapack z)
 
     if (CMAKE_MAJOR_VERSION GREATER 2  OR  CMAKE_MINOR_VERSION GREATER 4)
         foreach(__EXTRA_LIB ${OPENCV_EXTRA_COMPONENTS})
diff --git a/OpenCVFindOpenEXR.cmake b/OpenCVFindOpenEXR.cmake
index 85016ae..96396b3 100644
--- a/OpenCVFindOpenEXR.cmake
+++ b/OpenCVFindOpenEXR.cmake
@@ -44,7 +44,7 @@ FIND_LIBRARY(OPENEXR_ILMIMF_LIBRARY
 IF (OPENEXR_INCLUDE_PATH AND OPENEXR_IMATH_LIBRARY AND OPENEXR_ILMIMF_LIBRARY AND OPENEXR_IEX_LIBRARY AND OPENEXR_HALF_LIBRARY)
     SET(OPENEXR_FOUND TRUE)
     SET(OPENEXR_INCLUDE_PATHS ${OPENEXR_INCLUDE_PATH} CACHE STRING "The include paths needed to use OpenEXR")
-    SET(OPENEXR_LIBRARIES ${OPENEXR_IMATH_LIBRARY} ${OPENEXR_ILMIMF_LIBRARY} ${OPENEXR_IEX_LIBRARY} ${OPENEXR_HALF_LIBRARY} zlib CACHE STRING "The libraries needed to use OpenEXR")
+    SET(OPENEXR_LIBRARIES ${OPENEXR_IMATH_LIBRARY} ${OPENEXR_ILMIMF_LIBRARY} ${OPENEXR_IEX_LIBRARY} ${OPENEXR_HALF_LIBRARY} z CACHE STRING "The libraries needed to use OpenEXR")
 ENDIF ()
 
 IF(OPENEXR_FOUND)
diff --git a/modules/core/CMakeLists.txt b/modules/core/CMakeLists.txt
index b50a407..6784a3a 100644
--- a/modules/core/CMakeLists.txt
+++ b/modules/core/CMakeLists.txt
@@ -1,3 +1,3 @@
 include_directories("${CMAKE_CURRENT_SOURCE_DIR}/../../3rdparty/include")
-set(deps opencv_lapack zlib)
+set(deps lapack z)
 define_opencv_module(core ${deps})
diff --git a/modules/highgui/CMakeLists.txt b/modules/highgui/CMakeLists.txt
index 2a33cea..a07ae55 100644
--- a/modules/highgui/CMakeLists.txt
+++ b/modules/highgui/CMakeLists.txt
@@ -276,8 +276,8 @@ if(WITH_JPEG AND NOT JPEG_FOUND)
 endif()
 
 if(WITH_PNG AND NOT PNG_FOUND)
-	add_dependencies(${the_target} libpng zlib)
-	#target_link_libraries(${the_target} libpng zlib)
+	add_dependencies(${the_target} libpng z)
+	#target_link_libraries(${the_target} libpng z)
 endif()
 
 if(WITH_TIFF AND NOT TIFF_FOUND)
@@ -285,7 +285,7 @@ if(WITH_TIFF AND NOT TIFF_FOUND)
 	#target_link_libraries(${the_target} libtiff)
 endif()
 
-target_link_libraries(${the_target} ${OPENCV_LINKER_LIBS} opencv_core opencv_imgproc zlib ${JPEG_LIBRARIES} ${PNG_LIBRARIES} ${TIFF_LIBRARIES} ${JASPER_LIBRARIES} ${HIGHGUI_LIBRARIES} ${OPENEXR_LIBRARIES})
+target_link_libraries(${the_target} ${OPENCV_LINKER_LIBS} opencv_core opencv_imgproc z ${JPEG_LIBRARIES} ${PNG_LIBRARIES} ${TIFF_LIBRARIES} ${JASPER_LIBRARIES} ${HIGHGUI_LIBRARIES} ${OPENEXR_LIBRARIES})
 
 if(APPLE)
 	target_link_libraries(${the_target} "-lbz2 -framework Cocoa -framework QuartzCore")
-- 
